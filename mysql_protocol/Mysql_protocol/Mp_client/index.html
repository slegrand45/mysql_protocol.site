<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mp_client (mysql_protocol.Mysql_protocol.Mp_client)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">mysql_protocol</a> &#x00BB; <a href="../index.html">Mysql_protocol</a> &#x00BB; Mp_client</nav><header class="odoc-preamble"><h1>Module <code><span>Mysql_protocol.Mp_client</span></code></h1><p>MySQL Protocol natively implements the MySQL client protocol (ie without any binding to C library).</p><p>License:</p><ul><li>The MySQL Protocol library uses the <a href="http://www.gnu.org/licenses/lgpl.html">LGPL license version 3</a>.</li></ul><p>External dependencies:</p><ul><li><a href="https://github.com/xguerin/bitstring/">Bitstring</a>.</li><li><a href="https://github.com/xavierleroy/cryptokit/">Cryptokit</a>.</li><li>optional: <a href="https://github.com/gildor478/ounit/">oUnit</a> (to run the tests suite).</li></ul><p>Tested configurations:</p><ul><li>MySQL 5.1.69 server (64 bits) - FreeBSD -stable.</li><li>MySQL 5.5.31 server (64 bits) - FreeBSD -stable.</li><li>MySQL 5.6.26 server (64 bits) - FreeBSD -stable.</li><li>MariaDB 10.5.6 server (64 bits) - FreeBSD -stable.</li></ul><p>The following functionalities are not implemented:</p><ul><li>Master/slave.</li><li>Long data packet.</li><li>Compression.</li><li>Encryption.</li></ul><p>Known limitations:</p><ul><li>On 32 bits platforms, the data retrieved from the server cannot exceed 16777211 bytes (the OCaml Sys.max_string_length value). So, for instance, you cannot retrieve a column with a binary BLOB data greater than this max size. And if you have a TEXT column encoded in UTF-8, as a character will take 3 to 4 bytes, you will only be able to retrieve between 16777211/3=5592403 and 16777211/4=4194302 characters. On 64 bits platforms, the limit is so high that this limitation can be ignored.</li></ul><p>Usage examples:</p><ul><li>See &quot;examples&quot; directory.</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-client_error" class="anchored"><a href="#type-client_error" class="anchor"></a><code><span><span class="keyword">type</span> client_error</span><span> = </span><span>{</span></code><table><tr id="type-client_error.client_error_errno" class="anchored"><td class="def record field"><a href="#type-client_error.client_error_errno" class="anchor"></a><code><span>client_error_errno : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>error number</p><span class="comment-delim">*)</span></td></tr><tr id="type-client_error.client_error_sqlstate" class="anchored"><td class="def record field"><a href="#type-client_error.client_error_sqlstate" class="anchor"></a><code><span>client_error_sqlstate : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>state</p><span class="comment-delim">*)</span></td></tr><tr id="type-client_error.client_error_message" class="anchored"><td class="def record field"><a href="#type-client_error.client_error_message" class="anchor"></a><code><span>client_error_message : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>error message</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>MySQL error.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Error" class="anchored"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> <a href="#type-client_error">client_error</a></span></code></div><div class="spec-doc"><p>Raise if the MySQL server returns an error.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Fetch_no_more_rows" class="anchored"><a href="#exception-Fetch_no_more_rows" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Fetch_no_more_rows</span></span></code></div><div class="spec-doc"><p>Raise if fetch is called and the server has no more rows to return.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-configuration" class="anchored"><a href="#type-configuration" class="anchor"></a><code><span><span class="keyword">type</span> configuration</span><span> = </span><span>{</span></code><table><tr id="type-configuration.sockaddr" class="anchored"><td class="def record field"><a href="#type-configuration.sockaddr" class="anchor"></a><code><span>sockaddr : <span class="xref-unresolved">Unix</span>.sockaddr;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>socket</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.capabilities" class="anchored"><td class="def record field"><a href="#type-configuration.capabilities" class="anchor"></a><code><span>capabilities : <span><a href="../Mp_capabilities/index.html#type-capabilities">Mp_capabilities.capabilities</a> list</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>capabilities</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.max_packet_size" class="anchored"><td class="def record field"><a href="#type-configuration.max_packet_size" class="anchor"></a><code><span>max_packet_size : <span class="xref-unresolved">Stdlib</span>.Int64.t;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>max packet size</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.charset_number" class="anchored"><td class="def record field"><a href="#type-configuration.charset_number" class="anchor"></a><code><span>charset_number : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>charset</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.user" class="anchored"><td class="def record field"><a href="#type-configuration.user" class="anchor"></a><code><span>user : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>login</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.password" class="anchored"><td class="def record field"><a href="#type-configuration.password" class="anchor"></a><code><span>password : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>password</p><span class="comment-delim">*)</span></td></tr><tr id="type-configuration.databasename" class="anchored"><td class="def record field"><a href="#type-configuration.databasename" class="anchor"></a><code><span>databasename : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>database name (can be empty)</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Client configuration.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-connection" class="anchored"><a href="#type-connection" class="anchor"></a><code><span><span class="keyword">type</span> connection</span><span> = </span><span>{</span></code><table><tr id="type-connection.configuration" class="anchored"><td class="def record field"><a href="#type-connection.configuration" class="anchor"></a><code><span>configuration : <a href="#type-configuration">configuration</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>configuration</p><span class="comment-delim">*)</span></td></tr><tr id="type-connection.channel" class="anchored"><td class="def record field"><a href="#type-connection.channel" class="anchor"></a><code><span><span class="keyword">mutable</span> channel : <span><span>(<span class="xref-unresolved">Stdlib</span>.in_channel * <span class="xref-unresolved">Stdlib</span>.out_channel)</span> option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>channel between client and server</p><span class="comment-delim">*)</span></td></tr><tr id="type-connection.handshake" class="anchored"><td class="def record field"><a href="#type-connection.handshake" class="anchor"></a><code><span><span class="keyword">mutable</span> handshake : <span><a href="../Mp_handshake/index.html#type-handshake">Mp_handshake.handshake</a> option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>handshake answer from the server</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Client connection.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-dml_dcl_result" class="anchored"><a href="#type-dml_dcl_result" class="anchor"></a><code><span><span class="keyword">type</span> dml_dcl_result</span><span> = </span><span>{</span></code><table><tr id="type-dml_dcl_result.affected_rows" class="anchored"><td class="def record field"><a href="#type-dml_dcl_result.affected_rows" class="anchor"></a><code><span>affected_rows : <span class="xref-unresolved">Stdlib</span>.Int64.t;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>number of affected rows</p><span class="comment-delim">*)</span></td></tr><tr id="type-dml_dcl_result.insert_id" class="anchored"><td class="def record field"><a href="#type-dml_dcl_result.insert_id" class="anchor"></a><code><span>insert_id : <span class="xref-unresolved">Stdlib</span>.Int64.t * <span class="xref-unresolved">Big_int</span>.big_int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>auto_increment id after an INSERT statement</p><span class="comment-delim">*)</span></td></tr><tr id="type-dml_dcl_result.server_status" class="anchored"><td class="def record field"><a href="#type-dml_dcl_result.server_status" class="anchor"></a><code><span>server_status : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>status</p><span class="comment-delim">*)</span></td></tr><tr id="type-dml_dcl_result.warning_count" class="anchored"><td class="def record field"><a href="#type-dml_dcl_result.warning_count" class="anchor"></a><code><span>warning_count : int;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>warning</p><span class="comment-delim">*)</span></td></tr><tr id="type-dml_dcl_result.message" class="anchored"><td class="def record field"><a href="#type-dml_dcl_result.message" class="anchor"></a><code><span>message : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>warning message</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>DML (Data Manipulation Language) and DCL (Data Control Language) result. Result of INSERT, UPDATE, GRANT... statements.</p><p>insert_id can be negative in two cases:</p><ul><li>the auto_increment value is indeed negative (SIGNED field).</li><li>the returned value overflows Int64 maximum (BIGINT UNSIGNED field).</li></ul><p>Unfortunately, the protocol gives no way to differentiate these two cases (see <a href="https://bugs.mysql.com/bug.php?id=69228">this bug report</a>). So we return two values:</p><ul><li>the first one is a Int64 and must be used when the auto_increment is <b>_not_</b> a BIGINT UNSIGNED field.</li><li>the second one is a Big_int and must be used when the auto_increment is a BIGINT UNSIGNED field.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-prepare_result" class="anchored"><a href="#type-prepare_result" class="anchor"></a><code><span><span class="keyword">type</span> prepare_result</span><span> = </span><span>{</span></code><table><tr id="type-prepare_result.prepare_handler" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_handler" class="anchor"></a><code><span>prepare_handler : <span class="xref-unresolved">Stdlib</span>.Int64.t;</span></code></td></tr><tr id="type-prepare_result.prepare_nb_columns" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_nb_columns" class="anchor"></a><code><span>prepare_nb_columns : int;</span></code></td></tr><tr id="type-prepare_result.prepare_nb_parameters" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_nb_parameters" class="anchor"></a><code><span>prepare_nb_parameters : int;</span></code></td></tr><tr id="type-prepare_result.prepare_warning_count" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_warning_count" class="anchor"></a><code><span>prepare_warning_count : int;</span></code></td></tr><tr id="type-prepare_result.prepare_parameters_fields" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_parameters_fields" class="anchor"></a><code><span>prepare_parameters_fields : <span><a href="../Mp_field_packet/index.html#type-field_packet">Mp_field_packet.field_packet</a> list</span>;</span></code></td></tr><tr id="type-prepare_result.prepare_parameters_names" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_parameters_names" class="anchor"></a><code><span>prepare_parameters_names : <span><a href="../Mp_field/index.html#type-field_name">Mp_field.field_name</a> list</span>;</span></code></td></tr><tr id="type-prepare_result.prepare_columns_fields" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_columns_fields" class="anchor"></a><code><span>prepare_columns_fields : <span><a href="../Mp_field_packet/index.html#type-field_packet">Mp_field_packet.field_packet</a> list</span>;</span></code></td></tr><tr id="type-prepare_result.prepare_columns_names" class="anchored"><td class="def record field"><a href="#type-prepare_result.prepare_columns_names" class="anchor"></a><code><span>prepare_columns_names : <span><a href="../Mp_field/index.html#type-field_name">Mp_field.field_name</a> list</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Result for a prepare command.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-executable_statement" class="anchored"><a href="#type-executable_statement" class="anchor"></a><code><span><span class="keyword">type</span> executable_statement</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-execute_result" class="anchored"><a href="#type-execute_result" class="anchor"></a><code><span><span class="keyword">type</span> execute_result</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-result" class="anchored"><a href="#type-result" class="anchor"></a><code><span><span class="keyword">type</span> result</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-error_exception_to_string" class="anchored"><a href="#val-error_exception_to_string" class="anchor"></a><code><span><span class="keyword">val</span> error_exception_to_string : <span><a href="#type-client_error">client_error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert MySQL exception to string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dml_dcl_result_to_string" class="anchored"><a href="#val-dml_dcl_result_to_string" class="anchor"></a><code><span><span class="keyword">val</span> dml_dcl_result_to_string : <span><a href="#type-dml_dcl_result">dml_dcl_result</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert DML (Data Manipulation Language) and DCL (Data Control Language) result to string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-configuration" class="anchored"><a href="#val-configuration" class="anchor"></a><code><span><span class="keyword">val</span> configuration : 
  <span>user:string <span class="arrow">&#45;&gt;</span></span>
  <span>password:string <span class="arrow">&#45;&gt;</span></span>
  <span>sockaddr:<span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span>
  <span>?databasename:string <span class="arrow">&#45;&gt;</span></span>
  <span>?max_packet_size:<span class="xref-unresolved">Stdlib</span>.Int64.t <span class="arrow">&#45;&gt;</span></span>
  <span>?charset:<span>(<a href="../Mp_charset/index.html#type-charset_name">Mp_charset.charset_name</a> * <a href="../Mp_charset/index.html#type-collation_name">Mp_charset.collation_name</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?capabilities:<span><a href="../Mp_capabilities/index.html#type-capabilities">Mp_capabilities.capabilities</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-configuration">configuration</a></span></code></div><div class="spec-doc"><p>Build client configuration.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">user</span> <p>Login.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">password</span> <p>Password.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">sockaddr</span> <p>Socket for the connection to the server.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">databasename</span> <p>Database name.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">max_packet_size</span> <p>Max client/server packet size.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">charset</span> <p>Charset and collation name.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">capabilities</span> <p>Client capabilities.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span>configuration:<a href="#type-configuration">configuration</a> <span class="arrow">&#45;&gt;</span></span> <span>?force:bool <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-connection">connection</a></span></code></div><div class="spec-doc"><p>Connection to the server.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">configuration</span> <p>Client configuration.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">force</span> <p>If true, the connection is immediately opened. Otherwise, the connection is opened only the first time it is needed.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-change_user" class="anchored"><a href="#val-change_user" class="anchor"></a><code><span><span class="keyword">val</span> change_user : 
  <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span>
  <span>user:string <span class="arrow">&#45;&gt;</span></span>
  <span>password:string <span class="arrow">&#45;&gt;</span></span>
  <span>?databasename:string <span class="arrow">&#45;&gt;</span></span>
  <span>?charset:<span>(<a href="../Mp_charset/index.html#type-charset_name">Mp_charset.charset_name</a> * <a href="../Mp_charset/index.html#type-collation_name">Mp_charset.collation_name</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-configuration">configuration</a></span></code></div><div class="spec-doc"><p>Change user / databasename / charset</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">user</span> <p>Login.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">password</span> <p>Password.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">databasename</span> <p>Database name.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">charset</span> <p>Charset and collation name.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-reset_session" class="anchored"><a href="#val-reset_session" class="anchor"></a><code><span><span class="keyword">val</span> reset_session : <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Reset the session : equivalent to a disconnect/reconnect with the same configuration.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-reset_connection" class="anchored"><a href="#val-reset_connection" class="anchor"></a><code><span><span class="keyword">val</span> reset_connection : <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Reset the connection without re-authentication. From <a href="https://mariadb.com/kb/en/com_reset_connection/">documentation</a>), this will:</p><ul><li>rollback any open transaction</li><li>reset transaction isolation level</li><li>reset session variables</li><li>delete user variables</li><li>remove temporary tables</li><li>remove all PREPARE statement</li></ul><p>Database will NOT be reset to initial value.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-use_database" class="anchored"><a href="#val-use_database" class="anchor"></a><code><span><span class="keyword">val</span> use_database : <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>databasename:string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change current database.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">databasename</span> <p>Database name.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-ping" class="anchored"><a href="#val-ping" class="anchor"></a><code><span><span class="keyword">val</span> ping : <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send a PING to the server.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-create_statement_from_string" class="anchored"><a href="#val-create_statement_from_string" class="anchor"></a><code><span><span class="keyword">val</span> create_statement_from_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-executable_statement">executable_statement</a></span></code></div><div class="spec-doc"><p>Create a new statement from a SQL string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-prepare" class="anchored"><a href="#val-prepare" class="anchor"></a><code><span><span class="keyword">val</span> prepare : 
  <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span>
  <span>statement:<a href="#type-executable_statement">executable_statement</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-executable_statement">executable_statement</a></span></code></div><div class="spec-doc"><p>Prepare a statement.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">statement</span> <p>Executable statement.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-get_created_statement" class="anchored"><a href="#val-get_created_statement" class="anchor"></a><code><span><span class="keyword">val</span> get_created_statement : <span><a href="#type-executable_statement">executable_statement</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Extract the statement from an executable statement.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_prepared_statement" class="anchored"><a href="#val-get_prepared_statement" class="anchor"></a><code><span><span class="keyword">val</span> get_prepared_statement : <span><a href="#type-executable_statement">executable_statement</a> <span class="arrow">&#45;&gt;</span></span> string * <a href="#type-prepare_result">prepare_result</a></span></code></div><div class="spec-doc"><p>Extract the prepared statement from an executable statement.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-execute" class="anchored"><a href="#val-execute" class="anchor"></a><code><span><span class="keyword">val</span> execute : 
  <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span>
  <span>statement:<a href="#type-executable_statement">executable_statement</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?filter:<span><span>( <span><span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Mp_data/index.html#type-t">Mp_data.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?iter:<span><span>( <span><span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Mp_data/index.html#type-t">Mp_data.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit )</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?return_all_raw_mysql_data:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?params:<span><a href="../Mp_data/index.html#type-t">Mp_data.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?bind:<a href="../Mp_execute/index.html#type-bind">Mp_execute.bind</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?flag:<a href="../Mp_execute/index.html#type-flag">Mp_execute.flag</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-execute_result">execute_result</a></span></code></div><div class="spec-doc"><p>Execute a statement (prepared or not prepared) and return the result.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Client connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">statement</span> <p>Executable statement.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">filter</span> <p>Optional function applied to each row of the result. If it returns true, the row is kept in the return result. Otherwise, the row is discarded from the result.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">iter</span> <p>Optional function applied to each row of the result. If there is also a filter function, this filter is applied _before_ the iter function. So a row will be processed by the iter function only if this row has passed the filter function.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">return_all_raw_mysql_data</span> <p>If true, the returned result will include MySQL raw data. It's useful if you need for instance to get the MySQL columns types and options. The default is false.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">params</span> <p>List of params for prepared statement. Must be in the same order than in the prepared statement.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">bind</span> <p>Specify if the params must be bound into the prepared statement. The default is to bind. A statement must be at least executed once with bind. After that, if you need to execute again the same statement with the same params, you can use No_bind.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">flag</span> <p>Cursor options. To use fetch to get the statement results, you must specify the Cursor_type_read_only option.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-get_result" class="anchored"><a href="#val-get_result" class="anchor"></a><code><span><span class="keyword">val</span> get_result : <span><a href="#type-execute_result">execute_result</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p>Extract the result part from an executed result.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_result_multiple" class="anchored"><a href="#val-get_result_multiple" class="anchor"></a><code><span><span class="keyword">val</span> get_result_multiple : <span><a href="#type-execute_result">execute_result</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-result">result</a> list</span></span></code></div><div class="spec-doc"><p>Extract the multiple part from an executed result (for CALL result).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_result_set" class="anchored"><a href="#val-get_result_set" class="anchor"></a><code><span><span class="keyword">val</span> get_result_set : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Mp_result_set_packet/index.html#type-result_select">Mp_result_set_packet.result_select</a></span></code></div><div class="spec-doc"><p>Extract the set part from a result (for SELECT result).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_result_ok" class="anchored"><a href="#val-get_result_ok" class="anchor"></a><code><span><span class="keyword">val</span> get_result_ok : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-dml_dcl_result">dml_dcl_result</a></span></code></div><div class="spec-doc"><p>Extract the ok part from a result (for INSERT, UPDATE, GRANT... result).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fetch" class="anchored"><a href="#val-fetch" class="anchor"></a><code><span><span class="keyword">val</span> fetch : 
  <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span>
  <span>statement:<a href="#type-execute_result">execute_result</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?nb_rows:int64 <span class="arrow">&#45;&gt;</span></span>
  <span>?filter:<span><span>( <span><span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Mp_data/index.html#type-t">Mp_data.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?iter:<span><span>( <span><span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Mp_data/index.html#type-t">Mp_data.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit )</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?return_all_raw_mysql_data:bool <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-result">result</a></span></code></div><div class="spec-doc"><p>Fetch row(s) from an executed result. It must be a prepared statement executed with a cursor.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Client connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">statement</span> <p>Executable statement.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">nb_rows</span> <p>Number of row(s) to fetch. Default is 1.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">filter</span> <p>Optional function applied to each fetched rows. If it returns true, the row is kept. Otherwise, the row is discarded.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">iter</span> <p>Optional function applied to each fetched rows. If there is also a filter function, this filter is applied _before_ the iter function. So a row will be processed by the iter function only if this row has passed the filter function.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">return_all_raw_mysql_data</span> <p>If true, the fetch will include MySQL raw data. It's useful if you need for instance to get the MySQL columns types and options. The default is false.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-get_fetch_result_set" class="anchored"><a href="#val-get_fetch_result_set" class="anchor"></a><code><span><span class="keyword">val</span> get_fetch_result_set : <span><a href="#type-result">result</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Mp_result_set_packet/index.html#type-result_select">Mp_result_set_packet.result_select</a></span></code></div><div class="spec-doc"><p>Extract the set part from a fetch.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close_statement" class="anchored"><a href="#val-close_statement" class="anchor"></a><code><span><span class="keyword">val</span> close_statement : 
  <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span>
  <span>statement:<a href="#type-executable_statement">executable_statement</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Close and destroy the prepared statement. It will be unusable.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Client connection.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">statement</span> <p>Executable statement.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-disconnect" class="anchored"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span>connection:<a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close the connection to the server.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">connection</span> <p>Client connection.</p></li></ul></div></div></div></body></html>